<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Custom Website</title>
    <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
    <script src="https://unpkg.com/grapesjs"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>
    <div id="canvas"></div>
    <script>
        // Initialize Firebase
        const firebaseConfig = 
          // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyALur-2yhD8TfMkcrfRkcwmO1nUY5v4ig8",
  authDomain: "mywebsite-c3d28.firebaseapp.com",
  databaseURL: "https://mywebsite-c3d28-default-rtdb.firebaseio.com",
  projectId: "mywebsite-c3d28",
  storageBucket: "mywebsite-c3d28.firebasestorage.app",
  messagingSenderId: "795220290560",
  appId: "1:795220290560:web:7ae7e10f75587a4d8f7ce5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);   // Paste your Firebase config here
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const adminHash = '#admin';
        const adminPassword = 'admain123'; // Change this to your own password

        async function loadSite() {
            const snapshot = await db.ref('site').once('value');
            const data = snapshot.val() || { html: '<h1>Welcome to My Site</h1>', css: '' };
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = data.html;
            const style = document.createElement('style');
            style.innerHTML = data.css;
            document.head.appendChild(style);
        }

        function initEditor() {
            const password = prompt('Enter admin password:');
            if (password !== adminPassword) {
                alert('Wrong password!');
                window.location.hash = '';
                return;
            }

            const editor = grapesjs.init({
                container: '#canvas',
                storageManager: {
                    type: 'remote',
                    autoload: true,
                    autosave: true,
                    stepsBeforeSave: 1,
                    options: {
                        remote: {
                            urlLoad: async () => {
                                const snapshot = await db.ref('site').once('value');
                                return snapshot.val() || { html: '<h1>Welcome to My Site</h1>', css: '' };
                            },
                            urlStore: async (data) => {
                                await db.ref('site').set(data);
                            }
                        }
                    }
                },
                blockManager: {
                    appendTo: '#blocks',
                    blocks: [
                        { id: 'navbar', label: 'Navbar', content: '<nav style="background: #333; color: white; padding: 10px;"><ul><li>Home</li><li>About</li></ul></nav>' },
                        { id: 'text', label: 'Text Box', content: '<div>Edit this text</div>' },
                        { id: 'button', label: 'Button', content: '<button>Click Me</button>' },
                        { id: 'image', label: 'Image', content: { type: 'image', src: 'https://via.placeholder.com/150' } }
                    ]
                },
                styleManager: { appendTo: '#styles' },
                panels: { defaults: [] }
            });

            editor.Panels.addButton('options', {
                id: 'publish',
                className: 'fa fa-save',
                command: 'store-data',
                attributes: { title: 'Publish' }
            });
            editor.Commands.add('store-data', {
                run: async (editor) => {
                    await editor.store();
                    alert('Published! Visitors can now see changes.');
                }
            });
        }

        if (window.location.hash === adminHash) {
            initEditor();
        } else {
            loadSite();
        }
    </script>
    <div id="blocks" style="display:none;"></div>
    <div id="styles" style="display:none;"></div>
</body>
</html>